<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configurações - ORION PDV</title>
  <link rel="stylesheet" href="assets/css/orion-theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <div class="wrapper">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <img src="assets/img/logo.png" alt="ORION PDV">
        <span class="logo-text">ORION PDV</span>
      </div>
      
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="dashboard.html" class="nav-link">
            <i class="fas fa-tachometer-alt nav-icon"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="venda.html" class="nav-link">
            <i class="fas fa-shopping-cart nav-icon"></i>
            <span>Registrar Venda</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="produto.html" class="nav-link">
            <i class="fas fa-box nav-icon"></i>
            <span>Cadastrar Produto</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="cliente.html" class="nav-link">
            <i class="fas fa-user nav-icon"></i>
            <span>Cadastrar Cliente</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="relatorio.html" class="nav-link">
            <i class="fas fa-chart-bar nav-icon"></i>
            <span>Painel Financeiro</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="estoque.html" class="nav-link">
            <i class="fas fa-warehouse nav-icon"></i>
            <span>Gerenciar Estoque</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="config.html" class="nav-link active">
            <i class="fas fa-cog nav-icon"></i>
            <span>Configurações</span>
          </a>
        </li>
      </ul>
      
      <div style="margin-top: auto; padding: 1rem 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
          <i class="fas fa-user-circle" style="font-size: 1.5rem; margin-right: 10px;"></i>
          <div>
            <div id="user
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Configurações - ORION PDV</title>
  <link rel="stylesheet" href="assets/css/orion-theme.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
  <div class="wrapper">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="logo">
        <img src="assets/img/logo.png" alt="ORION PDV">
        <span class="logo-text">ORION PDV</span>
      </div>
      
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="dashboard.html" class="nav-link">
            <i class="fas fa-tachometer-alt nav-icon"></i>
            <span>Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="venda.html" class="nav-link">
            <i class="fas fa-shopping-cart nav-icon"></i>
            <span>Registrar Venda</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="produto.html" class="nav-link">
            <i class="fas fa-box nav-icon"></i>
            <span>Cadastrar Produto</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="cliente.html" class="nav-link">
            <i class="fas fa-user nav-icon"></i>
            <span>Cadastrar Cliente</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="relatorio.html" class="nav-link">
            <i class="fas fa-chart-bar nav-icon"></i>
            <span>Painel Financeiro</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="estoque.html" class="nav-link">
            <i class="fas fa-warehouse nav-icon"></i>
            <span>Gerenciar Estoque</span>
          </a>
        </li>
        <li class="nav-item">
          <a href="config.html" class="nav-link active">
            <i class="fas fa-cog nav-icon"></i>
            <span>Configurações</span>
          </a>
        </li>
      </ul>
      
      <div style="margin-top: auto; padding: 1rem 1.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
        <div style="display: flex; align-items: center; margin-bottom: 1rem;">
          <i class="fas fa-user-circle" style="font-size: 1.5rem; margin-right: 10px;"></i>
          <div>
            <div id="user-name" style="font-weight: 500;">Nome do Usuário</div>
            <small class="text-muted">Administrador</small>
          </div>
        </div>
        <button id="btn-logout" class="btn btn-outline-primary" style="width: 100%;">
          <i class="fas fa-sign-out-alt"></i> Sair
        </button>
      </div>
    </aside>

    <!-- Conteúdo principal -->
    <main class="content">
      <div class="header" style="margin-bottom: 1.5rem;">
        <h1>Configurações</h1>
        <div>
          <span id="current-date"></span>
        </div>
      </div>
      
      <!-- Abas das configurações -->
      <ul class="nav nav-tabs" style="margin-bottom: 1.5rem; border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
        <li class="nav-item">
          <a class="nav-link active" id="tab-empresa" href="#" style="color: var(--text-light); border: none; padding: 0.75rem 1.5rem; border-bottom: 2px solid var(--primary);">
            <i class="fas fa-store"></i> Empresa
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab-usuarios" href="#" style="color: var(--text-muted); border: none; padding: 0.75rem 1.5rem; border-bottom: 2px solid transparent;">
            <i class="fas fa-users"></i> Usuários
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab-backup" href="#" style="color: var(--text-muted); border: none; padding: 0.75rem 1.5rem; border-bottom: 2px solid transparent;">
            <i class="fas fa-database"></i> Backup e Restauração
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" id="tab-sistema" href="#" style="color: var(--text-muted); border: none; padding: 0.75rem 1.5rem; border-bottom: 2px solid transparent;">
            <i class="fas fa-cog"></i> Sistema
          </a>
        </li>
      </ul>
      
      <!-- Conteúdo das abas -->
      <div id="tab-content">
        <!-- Aba Empresa -->
        <div id="content-empresa" class="tab-pane active">
          <div class="card">
            <div class="card-header">
              <i class="fas fa-store"></i> Dados da Empresa
            </div>
            <div class="card-body">
              <form id="form-empresa">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                  <div class="form-group">
                    <label for="nome-empresa" class="form-label">Nome da Empresa</label>
                    <input type="text" id="nome-empresa" class="form-control" required>
                  </div>
                  
                  <div class="form-group">
                    <label for="slogan" class="form-label">Slogan</label>
                    <input type="text" id="slogan" class="form-control">
                  </div>
                  
                  <div class="form-group">
                    <label for="cnpj" class="form-label">CNPJ</label>
                    <input type="text" id="cnpj" class="form-control">
                  </div>
                  
                  <div class="form-group">
                    <label for="telefone-empresa" class="form-label">Telefone</label>
                    <input type="text" id="telefone-empresa" class="form-control">
                  </div>
                  
                  <div class="form-group">
                    <label for="email-empresa" class="form-label">E-mail</label>
                    <input type="email" id="email-empresa" class="form-control">
                  </div>
                  
                  <div class="form-group">
                    <label for="endereco-empresa" class="form-label">Endereço</label>
                    <input type="text" id="endereco-empresa" class="form-control">
                  </div>
                  
                  <div class="form-group">
                    <label for="cidade-empresa" class="form-label">Cidade/UF</label>
                    <input type="text" id="cidade-empresa" class="form-control">
                  </div>
                  
                  <div class="form-group">
                    <label for="logo-url" class="form-label">URL do Logo</label>
                    <input type="text" id="logo-url" class="form-control">
                  </div>
                </div>
                
                <h5 style="margin-top: 1.5rem; margin-bottom: 1rem;">Configurações de Aparência</h5>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                  <div class="form-group">
                    <label for="tema" class="form-label">Tema</label>
                    <select id="tema" class="form-control">
                      <option value="dark">Escuro (Padrão)</option>
                      <option value="light">Claro</option>
                    </select>
                  </div>
                  
                  <div class="form-group">
                    <label for="cor-primaria" class="form-label">Cor Primária</label>
                    <input type="color" id="cor-primaria" class="form-control" value="#0B3D91">
                  </div>
                  
                  <div class="form-group">
                    <label for="cor-secundaria" class="form-label">Cor Secundária</label>
                    <input type="color" id="cor-secundaria" class="form-control" value="#1E88E5">
                  </div>
                </div>
                
                <div style="text-align: right; margin-top: 1.5rem;">
                  <button type="submit" class="btn btn-primary">
                    <i class="fas fa-save"></i> Salvar Alterações
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
        
        <!-- Aba Usuários -->
        <div id="content-usuarios" class="tab-pane" style="display: none;">
          <div style="display: grid; grid-template-columns: 1fr 400px; gap: 1.5rem;">
            <!-- Lista de usuários -->
            <div class="card">
              <div class="card-header">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                  <div>
                    <i class="fas fa-users"></i> Usuários do Sistema
                  </div>
                  <button id="btn-novo-usuario" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Novo Usuário
                  </button>
                </div>
              </div>
              <div class="card-body">
                <div class="table-container">
                  <table class="table" id="tabela-usuarios">
                    <thead>
                      <tr>
                        <th>Usuário</th>
                        <th>Nome</th>
                        <th>Cargo</th>
                        <th>Perfil</th>
                        <th>Ações</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Preenchido via JavaScript -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            
            <!-- Formulário de usuário -->
            <div class="card" id="card-usuario">
              <div class="card-header">
                <i class="fas fa-user"></i> <span id="form-usuario-titulo">Novo Usuário</span>
              </div>
              <div class="card-body">
                <form id="form-usuario">
                  <input type="hidden" id="usuario-id">
                  
                  <div class="form-group">
                    <label for="username" class="form-label">Nome de Usuário</label>
                    <input type="text" id="username" class="form-control" required>
                  </div>
                  
                  <div class="form-group">
                    <label for="nome-usuario" class="form-label">Nome Completo</label>
                    <input type="text" id="nome-usuario" class="form-control" required>
                  </div>
                  
                  <div class="form-group">
                    <label for="cargo" class="form-label">Cargo</label>
                    <input type="text" id="cargo" class="form-control" required>
                  </div>
                  
                  <div class="form-group">
                    <label for="email-usuario" class="form-label">E-mail</label>
                    <input type="email" id="email-usuario" class="form-control" required>
                  </div>
                  
                  <div class="form-group">
                    <label for="perfil" class="form-label">Perfil</label>
                    <select id="perfil" class="form-control" required>
                      <option value="admin">Administrador</option>
                      <option value="vendedor">Vendedor</option>
                      <option value="supervisor">Supervisor</option>
                    </select>
                  </div>
                  
                  <div class="form-group">
                    <label for="senha" class="form-label">Senha</label>
                    <input type="password" id="senha" class="form-control" required>
                  </div>
                  
                  <div class="form-group">
                    <label for="confirmar-senha" class="form-label">Confirmar Senha</label>
                    <input type="password" id="confirmar-senha" class="form-control" required>
                  </div>
                  
                  <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                    <button type="button" id="btn-cancelar-usuario" class="btn btn-outline-primary" style="flex: 1;">
                      Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary" style="flex: 1;">
                      Salvar
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Aba Backup e Restauração -->
        <div id="content-backup" class="tab-pane" style="display: none;">
          <div class="row" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 1.5rem;">
            <!-- Backup -->
            <div class="card">
              <div class="card-header">
                <i class="fas fa-download"></i> Backup do Sistema
              </div>
              <div class="card-body">
                <p>O backup inclui todos os dados do sistema: produtos, clientes, vendas e configurações.</p>
                <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem;">
                  <button id="btn-backup-completo" class="btn btn-primary">
                    <i class="fas fa-download"></i> Gerar Backup Completo
                  </button>
                  <button id="btn-exportar-produtos" class="btn btn-outline-primary">
                    <i class="fas fa-box"></i> Exportar Produtos (CSV)
                  </button>
                  <button id="btn-exportar-clientes" class="btn btn-outline-primary">
                    <i class="fas fa-users"></i> Exportar Clientes (CSV)
                  </button>
                  <button id="btn-exportar-vendas" class="btn btn-outline-primary">
                    <i class="fas fa-shopping-cart"></i> Exportar Vendas (CSV)
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Restauração -->
            <div class="card">
              <div class="card-header">
                <i class="fas fa-upload"></i> Restaurar Backup
              </div>
              <div class="card-body">
                <div class="alert" style="background-color: rgba(255, 179, 0, 0.1); border: 1px solid rgba(255, 179, 0, 0.3); color: var(--warning); border-radius: var(--border-radius); padding: 1rem; margin-bottom: 1rem;">
                  <i class="fas fa-exclamation-triangle"></i> <strong>Atenção!</strong> A restauração de backup substituirá todos os dados atuais do sistema. Certifique-se de fazer um backup antes de restaurar.
                </div>
                
                <div class="form-group">
                  <label for="arquivo-backup" class="form-label">Selecione o arquivo de backup</label>
                  <input type="file" id="arquivo-backup" class="form-control" accept=".json">
                </div>
                
                <div style="margin-top: 1.5rem;">
                  <button id="btn-restaurar" class="btn btn-primary" disabled>
                    <i class="fas fa-upload"></i> Restaurar Backup
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Aba Sistema -->
        <div id="content-sistema" class="tab-pane" style="display: none;">
          <!-- Informações do Sistema -->
          <div class="card">
            <div class="card-header">
              <i class="fas fa-info-circle"></i> Informações do Sistema
            </div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div>
                  <p class="text-muted">Versão do Sistema</p>
                  <p><strong id="versao-sistema">1.0.0</strong></p>
                </div>
                <div>
                  <p class="text-muted">Versão do Banco de Dados</p>
                  <p><strong id="versao-db">1.0.0</strong></p>
                </div>
                <div>
                  <p class="text-muted">Último Backup</p>
                  <p><strong id="ultimo-backup">Nunca</strong></p>
                </div>
                <div>
                  <p class="text-muted">Última Atualização</p>
                  <p><strong id="ultima-atualizacao">18/04/2025</strong></p>
                </div>
              </div>
              
              <div class="card" style="margin-top: 1.5rem; background-color: rgba(255, 255, 255, 0.05);">
                <div class="card-header">
                  <i class="fas fa-hdd"></i> Armazenamento Local
                </div>
                <div class="card-body">
                  <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <span>Produtos</span>
                      <span id="tamanho-produtos">0 KB</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <span>Clientes</span>
                      <span id="tamanho-clientes">0 KB</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <span>Vendas</span>
                      <span id="tamanho-vendas">0 KB</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <span>Configurações</span>
                      <span id="tamanho-config">0 KB</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; font-weight: 600; margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                      <span>Total</span>
                      <span id="tamanho-total">0 KB</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Ações do Sistema -->
          <div class="card" style="margin-top: 1.5rem;">
            <div class="card-header">
              <i class="fas fa-tools"></i> Manutenção do Sistema
            </div>
            <div class="card-body">
              <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                <div class="card" style="background-color: rgba(255, 255, 255, 0.05);">
                  <div class="card-body" style="text-align: center; padding: 1.5rem;">
                    <i class="fas fa-trash" style="font-size: 2rem; color: var(--danger); margin-bottom: 1rem;"></i>
                    <h5>Limpar Dados de Exemplo</h5>
                    <p style="margin-bottom: 1.5rem;">Remove todos os produtos, clientes e vendas de exemplo.</p>
                    <button id="btn-limpar-exemplos" class="btn btn-outline-danger">
                      Limpar Dados de Exemplo
                    </button>
                  </div>
                </div>
                
                <div class="card" style="background-color: rgba(255, 255, 255, 0.05);">
                  <div class="card-body" style="text-align: center; padding: 1.5rem;">
                    <i class="fas fa-sync" style="font-size: 2rem; color: var(--warning); margin-bottom: 1rem;"></i>
                    <h5>Reiniciar Sistema</h5>
                    <p style="margin-bottom: 1.5rem;">Redefine todas as configurações para o padrão original.</p>
                    <button id="btn-reiniciar-sistema" class="btn btn-outline-warning">
                      Reiniciar Sistema
                    </button>
                  </div>
                </div>
                
                <div class="card" style="background-color: rgba(255, 255, 255, 0.05);">
                  <div class="card-body" style="text-align: center; padding: 1.5rem;">
                    <i class="fas fa-database" style="font-size: 2rem; color: var(--info); margin-bottom: 1rem;"></i>
                    <h5>Verificar Integridade</h5>
                    <p style="margin-bottom: 1.5rem;">Verifica e corrige problemas no banco de dados local.</p>
                    <button id="btn-verificar-integridade" class="btn btn-outline-info">
                      Verificar Integridade
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script src="assets/js/database.js"></script>
  <script src="assets/js/auth.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Verificar autenticação
      if (!auth.verificarAutenticacao()) {
        window.location.href = 'index.html';
        return;
      }
      
      // Elementos DOM - Abas
      const tabEmpresa = document.getElementById('tab-empresa');
      const tabUsuarios = document.getElementById('tab-usuarios');
      const tabBackup = document.getElementById('tab-backup');
      const tabSistema = document.getElementById('tab-sistema');
      
      const contentEmpresa = document.getElementById('content-empresa');
      const contentUsuarios = document.getElementById('content-usuarios');
      const contentBackup = document.getElementById('content-backup');
      const contentSistema = document.getElementById('content-sistema');
      
      // Elementos DOM - Formulário Empresa
      const formEmpresa = document.getElementById('form-empresa');
      const nomeEmpresaInput = document.getElementById('nome-empresa');
      const sloganInput = document.getElementById('slogan');
      const cnpjInput = document.getElementById('cnpj');
      const telefoneEmpresaInput = document.getElementById('telefone-empresa');
      const emailEmpresaInput = document.getElementById('email-empresa');
      const enderecoEmpresaInput = document.getElementById('endereco-empresa');
      const cidadeEmpresaInput = document.getElementById('cidade-empresa');
      const logoUrlInput = document.getElementById('logo-url');
      const temaSelect = document.getElementById('tema');
      const corPrimariaInput = document.getElementById('cor-primaria');
      const corSecundariaInput = document.getElementById('cor-secundaria');
      
      // Elementos DOM - Formulário Usuário
      const formUsuario = document.getElementById('form-usuario');
      const usuarioIdInput = document.getElementById('usuario-id');
      const usernameInput = document.getElementById('username');
      const nomeUsuarioInput = document.getElementById('nome-usuario');
      const cargoInput = document.getElementById('cargo');
      const emailUsuarioInput = document.getElementById('email-usuario');
      const perfilSelect = document.getElementById('perfil');
      const senhaInput = document.getElementById('senha');
      const confirmarSenhaInput = document.getElementById('confirmar-senha');
      const btnNovoUsuario = document.getElementById('btn-novo-usuario');
      const btnCancelarUsuario = document.getElementById('btn-cancelar-usuario');
      const formUsuarioTitulo = document.getElementById('form-usuario-titulo');
      
      // Elementos DOM - Backup e Restauração
      const btnBackupCompleto = document.getElementById('btn-backup-completo');
      const btnExportarProdutos = document.getElementById('btn-exportar-produtos');
      const btnExportarClientes = document.getElementById('btn-exportar-clientes');
      const btnExportarVendas = document.getElementById('btn-exportar-vendas');
      const arquivoBackupInput = document.getElementById('arquivo-backup');
      const btnRestaurar = document.getElementById('btn-restaurar');
      
      // Elementos DOM - Sistema
      const versaoSistemaEl = document.getElementById('versao-sistema');
      const versaoDbEl = document.getElementById('versao-db');
      const ultimoBackupEl = document.getElementById('ultimo-backup');
      const ultimaAtualizacaoEl = document.getElementById('ultima-atualizacao');
      const tamanhoProdutosEl = document.getElementById('tamanho-produtos');
      const tamanhoClientesEl = document.getElementById('tamanho-clientes');
      const tamanhoVendasEl = document.getElementById('tamanho-vendas');
      const tamanhoConfigEl = document.getElementById('tamanho-config');
      const tamanhoTotalEl = document.getElementById('tamanho-total');
      const btnLimparExemplos = document.getElementById('btn-limpar-exemplos');
      const btnReiniciarSistema = document.getElementById('btn-reiniciar-sistema');
      const btnVerificarIntegridade = document.getElementById('btn-verificar-integridade');
      
      // Variáveis de controle
      let modoEdicaoUsuario = false;
      
      // Dados do usuário
      const user = auth.getUsuarioAtual();
      document.getElementById('user-name').textContent = user.nome;
      
      // Data atual
      const dataAtual = new Date();
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('current-date').textContent = dataAtual.toLocaleDateString('pt-BR', options);
      
      // Carregar dados iniciais
      carregarConfigEmpresa();
      carregarUsuarios();
      carregarInfoSistema();
      
      // Event Listeners - Abas
      tabEmpresa.addEventListener('click', function(e) {
        e.preventDefault();
        ativarAba('empresa');
      });
      
      tabUsuarios.addEventListener('click', function(e) {
        e.preventDefault();
        ativarAba('usuarios');
      });
      
      tabBackup.addEventListener('click', function(e) {
        e.preventDefault();
        ativarAba('backup');
      });
      
      tabSistema.addEventListener('click', function(e) {
        e.preventDefault();
        ativarAba('sistema');
      });
      
      // Event Listeners - Formulário Empresa
      formEmpresa.addEventListener('submit', function(e) {
        e.preventDefault();
        salvarConfigEmpresa();
      });
      
      // Formatar CNPJ ao digitar
      cnpjInput.addEventListener('input', function() {
        let valor = this.value.replace(/\D/g, '');
        
        // Formatar como CNPJ (XX.XXX.XXX/XXXX-XX)
        valor = valor.replace(/^(\d{2})(\d)/, '$1.$2');
        valor = valor.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
        valor = valor.replace(/\.(\d{3})(\d)/, '.$1/$2');
        valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
        
        this.value = valor;
      });
      
      // Formatar telefone ao digitar
      telefoneEmpresaInput.addEventListener('input', function() {
        let valor = this.value.replace(/\D/g, '');
        
        if (valor.length <= 10) {
          // Telefone fixo
          valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
          valor = valor.replace(/(\d{4})(\d)/, '$1-$2');
        } else {
          // Celular
          valor = valor.replace(/(\d{2})(\d)/, '($1) $2');
          valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
        }
        
        this.value = valor;
      });
      
      // Event Listeners - Formulário Usuário
      formUsuario.addEventListener('submit', function(e) {
        e.preventDefault();
        salvarUsuario();
      });
      
      btnNovoUsuario.addEventListener('click', function() {
        novoUsuario();
      });
      
      btnCancelarUsuario.addEventListener('click', function() {
        cancelarUsuario();
      });
      
      // Event Listeners - Backup e Restauração
      btnBackupCompleto.addEventListener('click', function() {
        gerarBackupCompleto();
      });
      
      btnExportarProdutos.addEventListener('click', function() {
        exportarProdutos();
      });
      
      btnExportarClientes.addEventListener('click', function() {
        exportarClientes();
      });
      
      btnExportarVendas.addEventListener('click', function() {
        exportarVendas();
      });
      
      arquivoBackupInput.addEventListener('change', function() {
        btnRest
arquivoBackupInput.addEventListener('change', function() {
        btnRestaurar.disabled = !this.files.length;
      });
      
      btnRestaurar.addEventListener('click', function() {
        restaurarBackup();
      });
      
      // Event Listeners - Sistema
      btnLimparExemplos.addEventListener('click', function() {
        limparDadosExemplo();
      });
      
      btnReiniciarSistema.addEventListener('click', function() {
        reiniciarSistema();
      });
      
      btnVerificarIntegridade.addEventListener('click', function() {
        verificarIntegridade();
      });
      
      // Logout
      document.getElementById('btn-logout').addEventListener('click', function() {
        auth.fazerLogout();
        window.location.href = 'index.html';
      });
      
      // Funções - Abas
      function ativarAba(aba) {
        // Desativar todas as abas
        tabEmpresa.classList.remove('active');
        tabEmpresa.style.color = 'var(--text-muted)';
        tabEmpresa.style.borderBottom = '2px solid transparent';
        
        tabUsuarios.classList.remove('active');
        tabUsuarios.style.color = 'var(--text-muted)';
        tabUsuarios.style.borderBottom = '2px solid transparent';
        
        tabBackup.classList.remove('active');
        tabBackup.style.color = 'var(--text-muted)';
        tabBackup.style.borderBottom = '2px solid transparent';
        
        tabSistema.classList.remove('active');
        tabSistema.style.color = 'var(--text-muted)';
        tabSistema.style.borderBottom = '2px solid transparent';
        
        // Ocultar todos os conteúdos
        contentEmpresa.style.display = 'none';
        contentUsuarios.style.display = 'none';
        contentBackup.style.display = 'none';
        contentSistema.style.display = 'none';
        
        // Ativar aba selecionada
        if (aba === 'empresa') {
          tabEmpresa.classList.add('active');
          tabEmpresa.style.color = 'var(--text-light)';
          tabEmpresa.style.borderBottom = '2px solid var(--primary)';
          contentEmpresa.style.display = 'block';
        } else if (aba === 'usuarios') {
          tabUsuarios.classList.add('active');
          tabUsuarios.style.color = 'var(--text-light)';
          tabUsuarios.style.borderBottom = '2px solid var(--primary)';
          contentUsuarios.style.display = 'block';
        } else if (aba === 'backup') {
          tabBackup.classList.add('active');
          tabBackup.style.color = 'var(--text-light)';
          tabBackup.style.borderBottom = '2px solid var(--primary)';
          contentBackup.style.display = 'block';
        } else if (aba === 'sistema') {
          tabSistema.classList.add('active');
          tabSistema.style.color = 'var(--text-light)';
          tabSistema.style.borderBottom = '2px solid var(--primary)';
          contentSistema.style.display = 'block';
        }
      }
      
      // Funções - Empresa
      function carregarConfigEmpresa() {
        const config = db.getConfig();
        
        // Preencher formulário
        nomeEmpresaInput.value = config.nome_empresa || 'ORION PDV';
        sloganInput.value = config.slogan || 'Gestão Inteligente de Vendas';
        cnpjInput.value = config.cnpj || '';
        telefoneEmpresaInput.value = config.telefone || '';
        emailEmpresaInput.value = config.email || '';
        enderecoEmpresaInput.value = config.endereco || '';
        cidadeEmpresaInput.value = config.cidade || '';
        logoUrlInput.value = config.logo_url || 'assets/img/logo.png';
        temaSelect.value = config.tema || 'dark';
        corPrimariaInput.value = config.cor_primaria || '#0B3D91';
        corSecundariaInput.value = config.cor_secundaria || '#1E88E5';
      }
      
      function salvarConfigEmpresa() {
        // Obter valores do formulário
        const config = {
          nome_empresa: nomeEmpresaInput.value.trim(),
          slogan: sloganInput.value.trim(),
          cnpj: cnpjInput.value.trim(),
          telefone: telefoneEmpresaInput.value.trim(),
          email: emailEmpresaInput.value.trim(),
          endereco: enderecoEmpresaInput.value.trim(),
          cidade: cidadeEmpresaInput.value.trim(),
          logo_url: logoUrlInput.value.trim(),
          tema: temaSelect.value,
          cor_primaria: corPrimariaInput.value,
          cor_secundaria: corSecundariaInput.value
        };
        
        try {
          // Salvar configurações
          db.salvarConfig(config);
          
          // Mensagem de sucesso
          exibirMensagem('Configurações salvas com sucesso', 'success');
          
          // Atualizar tema se necessário
          const temaAtual = document.body.classList.contains('theme-light') ? 'light' : 'dark';
          if (config.tema !== temaAtual) {
            aplicarTema(config.tema);
          }
        } catch (erro) {
          exibirMensagem('Erro ao salvar configurações: ' + erro, 'error');
        }
      }
      
      function aplicarTema(tema) {
        if (tema === 'light') {
          document.body.classList.remove('theme-dark');
          document.body.classList.add('theme-light');
        } else {
          document.body.classList.remove('theme-light');
          document.body.classList.add('theme-dark');
        }
      }
      
      // Funções - Usuários
      function carregarUsuarios() {
        const usuarios = db.getUsuarios();
        const tbody = document.querySelector('#tabela-usuarios tbody');
        
        // Limpar tabela
        tbody.innerHTML = '';
        
        // Adicionar usuários à tabela
        Object.values(usuarios).forEach(usuario => {
          const tr = document.createElement('tr');
          
          tr.innerHTML = `
            <td>${usuario.username}</td>
            <td>${usuario.nome}</td>
            <td>${usuario.cargo}</td>
            <td>${usuario.perfil === 'admin' ? 'Administrador' : usuario.perfil === 'vendedor' ? 'Vendedor' : 'Supervisor'}</td>
            <td>
              <button class="btn btn-outline-primary btn-sm btn-editar-usuario" data-username="${usuario.username}">
                <i class="fas fa-edit"></i>
              </button>
              <button class="btn btn-outline-danger btn-sm btn-excluir-usuario" data-username="${usuario.username}">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
          
          tbody.appendChild(tr);
        });
        
        // Adicionar eventos aos botões
        document.querySelectorAll('.btn-editar-usuario').forEach(btn => {
          btn.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            editarUsuario(username);
          });
        });
        
        document.querySelectorAll('.btn-excluir-usuario').forEach(btn => {
          btn.addEventListener('click', function() {
            const username = this.getAttribute('data-username');
            excluirUsuario(username);
          });
        });
      }
      
      function novoUsuario() {
        // Limpar formulário
        formUsuario.reset();
        usuarioIdInput.value = '';
        
        // Configurar modo
        modoEdicaoUsuario = false;
        formUsuarioTitulo.textContent = 'Novo Usuário';
      }
      
      function editarUsuario(username) {
        const usuario = db.getUsuario(username);
        
        if (usuario) {
          // Preencher formulário
          usuarioIdInput.value = usuario.username;
          usernameInput.value = usuario.username;
          nomeUsuarioInput.value = usuario.nome;
          cargoInput.value = usuario.cargo;
          emailUsuarioInput.value = usuario.email;
          perfilSelect.value = usuario.perfil;
          senhaInput.value = '';
          confirmarSenhaInput.value = '';
          
          // Desabilitar campo de usuário na edição
          usernameInput.disabled = true;
          
          // Configurar modo
          modoEdicaoUsuario = true;
          formUsuarioTitulo.textContent = 'Editar Usuário';
        }
      }
      
      function excluirUsuario(username) {
        const usuario = db.getUsuario(username);
        
        // Não permitir excluir o próprio usuário logado
        if (username === auth.getUsuarioAtual().username) {
          exibirMensagem('Não é possível excluir o usuário logado', 'error');
          return;
        }
        
        // Verificar se há pelo menos um administrador
        const usuarios = db.getUsuarios();
        const admins = Object.values(usuarios).filter(u => u.perfil === 'admin');
        
        if (usuario.perfil === 'admin' && admins.length <= 1) {
          exibirMensagem('Não é possível excluir o último administrador do sistema', 'error');
          return;
        }
        
        if (usuario) {
          const confirmar = confirm(`Deseja realmente excluir o usuário "${usuario.nome}"?`);
          
          if (confirmar) {
            try {
              // Excluir usuário
              delete usuarios[username];
              localStorage.setItem('orion_usuarios', JSON.stringify(usuarios));
              
              // Atualizar tabela
              carregarUsuarios();
              
              // Mensagem de sucesso
              exibirMensagem('Usuário excluído com sucesso', 'success');
            } catch (erro) {
              exibirMensagem('Erro ao excluir usuário: ' + erro, 'error');
            }
          }
        }
      }
      
      function salvarUsuario() {
        // Validar formulário
        if (!usernameInput.value.trim()) {
          exibirMensagem('Nome de usuário é obrigatório', 'error');
          return;
        }
        
        if (!nomeUsuarioInput.value.trim()) {
          exibirMensagem('Nome completo é obrigatório', 'error');
          return;
        }
        
        if (!emailUsuarioInput.value.trim()) {
          exibirMensagem('E-mail é obrigatório', 'error');
          return;
        }
        
        if (!modoEdicaoUsuario && !senhaInput.value) {
          exibirMensagem('Senha é obrigatória', 'error');
          return;
        }
        
        if (senhaInput.value && senhaInput.value !== confirmarSenhaInput.value) {
          exibirMensagem('As senhas não conferem', 'error');
          return;
        }
        
        // Obter usuários atuais
        const usuarios = db.getUsuarios();
        
        // Verificar se usuário já existe (apenas no modo de criação)
        if (!modoEdicaoUsuario && usuarios[usernameInput.value]) {
          exibirMensagem('Este nome de usuário já está em uso', 'error');
          return;
        }
        
        // Preparar objeto do usuário
        const usuario = {
          username: usernameInput.value.trim(),
          nome: nomeUsuarioInput.value.trim(),
          cargo: cargoInput.value.trim(),
          email: emailUsuarioInput.value.trim(),
          perfil: perfilSelect.value
        };
        
        // Adicionar senha se informada
        if (senhaInput.value) {
          usuario.senha_hash = auth.hashSenha(senhaInput.value);
        } else if (modoEdicaoUsuario) {
          // Manter senha atual
          usuario.senha_hash = usuarios[usuarioIdInput.value].senha_hash;
        }
        
        try {
          // Salvar usuário
          if (modoEdicaoUsuario) {
            // Modo edição: atualizar usuário existente
            const usernameAntigo = usuarioIdInput.value;
            
            // Se o username for diferente, excluir o antigo
            if (usernameAntigo !== usuario.username) {
              delete usuarios[usernameAntigo];
            }
            
            usuarios[usuario.username] = usuario;
          } else {
            // Modo criação: adicionar novo usuário
            usuarios[usuario.username] = usuario;
          }
          
          // Salvar no localStorage
          localStorage.setItem('orion_usuarios', JSON.stringify(usuarios));
          
          // Atualizar tabela
          carregarUsuarios();
          
          // Limpar formulário
          formUsuario.reset();
          usuarioIdInput.value = '';
          usernameInput.disabled = false;
          
          // Resetar modo
          modoEdicaoUsuario = false;
          formUsuarioTitulo.textContent = 'Novo Usuário';
          
          // Mensagem de sucesso
          exibirMensagem('Usuário salvo com sucesso', 'success');
        } catch (erro) {
          exibirMensagem('Erro ao salvar usuário: ' + erro, 'error');
        }
      }
      
      function cancelarUsuario() {
        // Limpar formulário
        formUsuario.reset();
        usuarioIdInput.value = '';
        usernameInput.disabled = false;
        
        // Resetar modo
        modoEdicaoUsuario = false;
        formUsuarioTitulo.textContent = 'Novo Usuário';
      }
      
      // Funções - Backup e Restauração
      function gerarBackupCompleto() {
        try {
          // Gerar backup
          db.gerarBackup();
          
          // Atualizar informações
          carregarInfoSistema();
          
          // Mensagem de sucesso
          exibirMensagem('Backup gerado com sucesso', 'success');
        } catch (erro) {
          exibirMensagem('Erro ao gerar backup: ' + erro, 'error');
        }
      }
      
      function exportarProdutos() {
        try {
          // Obter produtos
          const produtos = db.getProdutos();
          
          // Transformar para formato de tabela
          const dados = Object.values(produtos).map(produto => ({
            ID: produto.id,
            'Código de Barras': produto.codigo_barras,
            Nome: produto.nome,
            Grupo: produto.grupo,
            Marca: produto.marca || '',
            'Preço': produto.preco.toFixed(2),
            Estoque: produto.estoque,
            'Estoque Mínimo': produto.estoque_minimo,
            'Data de Cadastro': new Date(produto.data_cadastro).toLocaleDateString('pt-BR'),
            'URL da Foto': produto.foto || ''
          }));
          
          // Exportar para CSV
          const nomeArquivo = `produtos_${new Date().toISOString().split('T')[0]}.csv`;
          db.exportarCSV(dados, nomeArquivo);
          
          // Mensagem de sucesso
          exibirMensagem('Produtos exportados com sucesso', 'success');
        } catch (erro) {
          exibirMensagem('Erro ao exportar produtos: ' + erro, 'error');
        }
      }
      
      function exportarClientes() {
        try {
          // Obter clientes
          const clientes = db.getClientes();
          
          // Transformar para formato de tabela
          const dados = clientes.map(cliente => ({
            ID: cliente.id,
            Nome: cliente.nome,
            Documento: cliente.documento || '',
            Telefone: cliente.telefone || '',
            Email: cliente.email || '',
            Endereço: cliente.endereco || '',
            Cidade: cliente.cidade || '',
            'Data de Cadastro': cliente.data_cadastro ? new Date(cliente.data_cadastro).toLocaleDateString('pt-BR') : '',
            Observações: cliente.observacoes || ''
          }));
          
          // Exportar para CSV
          const nomeArquivo = `clientes_${new Date().toISOString().split('T')[0]}.csv`;
          db.exportarCSV(dados, nomeArquivo);
          
          // Mensagem de sucesso
          exibirMensagem('Clientes exportados com sucesso', 'success');
        } catch (erro) {
          exibirMensagem('Erro ao exportar clientes: ' + erro, 'error');
        }
      }
      
      function exportarVendas() {
        try {
          // Obter vendas
          const vendas = db.getVendas();
          
          // Transformar para formato de tabela
          const dados = vendas.map(venda => ({
            ID: venda.id,
            Data: new Date(venda.data).toLocaleDateString('pt-BR') + ' ' + new Date(venda.data).toLocaleTimeString('pt-BR'),
            Cliente: venda.cliente_nome,
            'Forma de Pagamento': venda.forma_pagamento,
            Subtotal: venda.subtotal.toFixed(2),
            Desconto: venda.desconto.toFixed(2),
            Total: venda.total.toFixed(2),
            Itens: venda.itens.length,
            Operador: venda.usuario
          }));
          
          // Exportar para CSV
          const nomeArquivo = `vendas_${new Date().toISOString().split('T')[0]}.csv`;
          db.exportarCSV(dados, nomeArquivo);
          
          // Mensagem de sucesso
          exibirMensagem('Vendas exportadas com sucesso', 'success');
        } catch (erro) {
          exibirMensagem('Erro ao exportar vendas: ' + erro, 'error');
        }
      }
      
      function restaurarBackup() {
        // Verificar se há arquivo selecionado
        if (!arquivoBackupInput.files.length) {
          exibirMensagem('Selecione um arquivo de backup', 'error');
          return;
        }
        
        // Confirmar restauração
        const confirmar = confirm('ATENÇÃO: A restauração substituirá todos os dados atuais. Deseja continuar?');
        
        if (confirmar) {
          const arquivo = arquivoBackupInput.files[0];
          const leitor = new FileReader();
          
          leitor.onload = function(e) {
            try {
              // Restaurar backup
              const resultado = db.restaurarBackup(e.target.result);
              
              if (resultado.sucesso) {
                // Mensagem de sucesso
                exibirMensagem(resultado.mensagem, 'success');
                
                // Atualizar informações
                carregarInfoSistema();
                carregarConfigEmpresa();
                carregarUsuarios();
                
                // Limpar input
                arquivoBackupInput.value = '';
                btnRestaurar.disabled = true;
              } else {
                exibirMensagem(resultado.mensagem, 'error');
              }
            } catch (erro) {
              exibirMensagem('Erro ao restaurar backup: ' + erro, 'error');
            }
          };
          
          leitor.readAsText(arquivo);
        }
      }
      
      // Funções - Sistema
      function carregarInfoSistema() {
        // Versão do sistema
        versaoSistemaEl.textContent = '1.0.0';
        
        // Versão do banco de dados
        const versaoDB = localStorage.getItem('orion_version') || '0.0.0';
        versaoDbEl.textContent = versaoDB;
        
        // Último backup
        const ultimoBackup = localStorage.getItem('orion_ultimo_backup');
        ultimoBackupEl.textContent = ultimoBackup ? new Date(ultimoBackup).toLocaleString() : 'Nunca';
        
        // Última atualização
        ultimaAtualizacaoEl.textContent = '18/04/2025';
        
        // Calcular tamanhos
        calcularTamanhosDados();
      }
      
      function calcularTamanhosDados() {
        // Tamanho dos produtos
        const tamanhoProdutos = new Blob([localStorage.getItem('orion_produtos') || '{}']).size;
        tamanhoProdutosEl.textContent = formatarTamanho(tamanhoProdutos);
        
        // Tamanho dos clientes
        const tamanhoClientes = new Blob([localStorage.getItem('orion_clientes') || '[]']).size;
        tamanhoClientesEl.textContent = formatarTamanho(tamanhoClientes);
        
        // Tamanho das vendas
        const tamanhoVendas = new Blob([localStorage.getItem('orion_vendas') || '[]']).size;
        tamanhoVendasEl.textContent = formatarTamanho(tamanhoVendas);
        
        // Tamanho das configurações
        const tamanhoConfig = new Blob([localStorage.getItem('orion_config') || '{}']).size;
        tamanhoConfigEl.textContent = formatarTamanho(tamanhoConfig);
        
        // Tamanho total
        const tamanhoTotal = tamanhoProdutos + tamanhoClientes + tamanhoVendas + tamanhoConfig;
        tamanhoTotalEl.textContent = formatarTamanho(tamanhoTotal);
      }
      
      function formatarTamanho(bytes) {
        if (bytes < 1024) {
          return bytes + ' bytes';
        } else if (bytes < 1024 * 1024) {
          return (bytes / 1024).toFixed(2) + ' KB';
        } else {
          return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }
      }
      
      function limparDadosExemplo() {
        // Confirmar exclusão
        const confirmar = confirm('Deseja realmente remover todos os dados de exemplo do sistema?');
        
        if (confirmar) {
          try {
            // Manter apenas o cliente "Consumidor Final"
            const clientes = db.getClientes();
            const clienteConsumidor = clientes.find(c => c.id === "1" && c.nome === "Consumidor Final");
            
            // Reiniciar dados
            localStorage.setItem('orion_produtos', '{}');
            localStorage.setItem('orion_clientes', JSON.stringify([clienteConsumidor]));
            localStorage.setItem('orion_vendas', '[]');
            localStorage.setItem('orion_carrinho', '[]');
            
            // Atualizar informações
            carregarInfoSistema();
            
            // Mensagem de sucesso
            exibirMensagem('Dados de exemplo removidos com sucesso', 'success');
          } catch (erro) {
            exibirMensagem('Erro ao remover dados de exemplo: ' + erro, 'error');
          }
        }
      }
      
      function reiniciarSistema() {
        // Confirmar reinicialização
        const confirmar = confirm('ATENÇÃO: Esta ação redefinirá o sistema para o estado original. Todos os dados serão perdidos. Deseja continuar?');
        
        if (confirmar) {
          try {
            // Limpar dados e reinicializar
            localStorage.clear();
            localStorage.setItem('orion_initialized', 'false');
            
            // Mensagem e redirecionamento
            alert('Sistema reiniciado com sucesso. A página será recarregada.');
            window.location.href = 'index.html';
          } catch (erro) {
            exibirMensagem('Erro ao reiniciar sistema: ' + erro, 'error');
          }
        }
      }
      
      function verificarIntegridade() {
        try {
          // Verificar estruturas
          const problemas = [];
          
          // Verificar produtos
          try {
            const produtos = JSON.parse(localStorage.getItem('orion_produtos') || '{}');
            
            // Verificar se cada produto tem os campos obrigatórios
            Object.values(produtos).forEach(produto => {
              if (!produto.id || !produto.nome || !produto.codigo_barras || produto.preco === undefined) {
                problemas.push(`Produto com dados incompletos: ${produto.id || 'ID desconhecido'}`);
              }
            });
          } catch (e) {
            problemas.push('Erro ao verificar produtos: ' + e.message);
          }
          
          // Verificar clientes
          try {
            const clientes = JSON.parse(localStorage.getItem('orion_clientes') || '[]');
            
            // Verificar se cada cliente tem os campos obrigatórios
            clientes.forEach(cliente => {
              if (!cliente.id || !cliente.nome) {
                problemas.push(`Cliente com dados incompletos: ${cliente.id || 'ID desconhecido'}`);
              }
            });
            
            // Verificar cliente "Consumidor Final"
            if (!clientes.some(c => c.id === "1" && c.nome === "Consumidor Final")) {
              problemas.push('Cliente "Consumidor Final" não encontrado');
            }
          } catch (e) {
            problemas.push('Erro ao verificar clientes: ' + e.message);
          }
          
          // Verificar vendas
          try {
            const vendas = JSON.parse(localStorage.getItem('orion_vendas') || '[]');
            
            // Verificar se cada venda tem os campos obrigatórios
            vendas.forEach(venda => {
              if (!venda.id || !venda.data || !venda.cliente_id || !venda.forma_pagamento || !venda.itens) {
                problemas.push(`Venda com dados incompletos: ${venda.id || 'ID desconhecido'}`);
              }
            });
          } catch (e) {
            problemas.push('Erro ao verificar vendas: ' + e.message);
          }
          
          // Exibir resultado
          if (problemas.length > 0) {
            // Criar modal com problemas
            const modalHtml = `
              <div id="modal-integridade" class="modal" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 1000; justify-content: center; align-items: center;">
                <div class="modal-content" style="background-color: var(--dark-surface); width: 600px; max-width: 90%; border-radius: var(--border-radius); box-shadow: var(--box-shadow);">
                  <div class="card-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h3><i class="fas fa-exclamation-triangle" style="color: var(--warning);"></i> Problemas Encontrados</h3>
                    <button type="button" class="btn-close-modal" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">&times;</button>
                  </div>
                  <div class="card-body">
                    <p>Foram encontrados ${problemas.length} problemas no banco de dados:</p>
                    <ul style="max-height: 300px; overflow-y: auto; margin: 1rem 0; padding-left: 1.5rem;">
                      ${problemas.map(problema => `<li>${problema}</li>`).join('')}
                    </ul>
                    <p>Deseja corrigir automaticamente estes problemas?</p>
                    <div style="display: flex; justify-content: flex-end; gap: 0.5rem; margin-top: 1.5rem;">
                      <button type="button" class="btn-close-modal btn btn-outline-primary">
                        Cancelar
                      </button>
                      <button type="button" id="btn-corrigir" class="btn btn-primary">
                        <i class="fas fa-wrench"></i> Corrigir Problemas
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            `;
            
            // Adicionar modal ao DOM
            const modalContainer = document.createElement('div');
            modalContainer.innerHTML = modalHtml;
            document.body.appendChild(modalContainer);
            
            // Adicionar eventos
            document.querySelectorAll('.btn-close-modal').forEach(btn => {
              btn.addEventListener('click', function() {
                document.body.removeChild(modalContainer);
              });
            });
            
            document.getElementById('btn-corrigir').addEventListener('click', function() {
              // Corrigir problemas
              corrigirProblemas();
              
              // Fechar modal
              document.body.removeChild(modalContainer);
            });
          } else {
            exibirMensagem('Verificação concluída. Nenhum problema encontrado!', 'success');
          }
        } catch (erro) {
          exibirMensagem('Erro ao verificar integridade: ' + erro, 'error');
        }
      }
      
      function corrigirProblemas() {
        try {
          // Verificar cliente "Consumidor Final"
          const clientes = JSON.parse(localStorage.getItem('orion_clientes') || '[]');
          const temClienteConsumidor = clientes.some(c => c.id === "1" && c.nome === "Consumidor Final");
          
          if (!temClienteConsumidor) {
            // Adicionar cliente padrão
            clientes.push({
              id: "1",
              nome: "Consumidor Final",
              documento: "",
              telefone: "",
              email: "",
              endereco: "",
              cidade: "",
              data_cadastro: new Date().toISOString()
            });
            
            localStorage.setItem('orion_clientes', JSON.stringify(clientes));
          }
          
          // Verificar configurações
          const config = JSON.parse(localStorage.getItem('orion_config') || '{}');
          
          if (!config.nome_empresa) {
            config.nome_empresa = "ORION PDV";
            config.slogan = "Gestão Inteligente de Vendas";
            config.tema = "dark";
            config.cor_prim
function corrigirProblemas() {
        try {
          // Verificar cliente "Consumidor Final"
          const clientes = JSON.parse(localStorage.getItem('orion_clientes') || '[]');
          const temClienteConsumidor = clientes.some(c => c.id === "1" && c.nome === "Consumidor Final");
          
          if (!temClienteConsumidor) {
            // Adicionar cliente padrão
            clientes.push({
              id: "1",
              nome: "Consumidor Final",
              documento: "",
              telefone: "",
              email: "",
              endereco: "",
              cidade: "",
              data_cadastro: new Date().toISOString()
            });
            
            localStorage.setItem('orion_clientes', JSON.stringify(clientes));
          }
          
          // Verificar configurações
          const config = JSON.parse(localStorage.getItem('orion_config') || '{}');
          
          if (!config.nome_empresa) {
            config.nome_empresa = "ORION PDV";
            config.slogan = "Gestão Inteligente de Vendas";
            config.tema = "dark";
            config.cor_primaria = "#0B3D91";
            config.cor_secundaria = "#1E88E5";
            
            localStorage.setItem('orion_config', JSON.stringify(config));
          }
          
          // Criar estruturas vazias se não existirem
          if (!localStorage.getItem('orion_produtos')) {
            localStorage.setItem('orion_produtos', '{}');
          }
          
          if (!localStorage.getItem('orion_vendas')) {
            localStorage.setItem('orion_vendas', '[]');
          }
          
          if (!localStorage.getItem('orion_carrinho')) {
            localStorage.setItem('orion_carrinho', '[]');
          }
          
          // Definir versão
          localStorage.setItem('orion_version', '1.0.0');
          localStorage.setItem('orion_initialized', 'true');
          
          // Atualizar informações
          carregarInfoSistema();
          carregarConfigEmpresa();
          carregarUsuarios();
          
          // Mensagem de sucesso
          exibirMensagem('Problemas corrigidos com sucesso!', 'success');
        } catch (erro) {
          exibirMensagem('Erro ao corrigir problemas: ' + erro, 'error');
        }
      }
      
      // Função auxiliar para exibir mensagens
      function exibirMensagem(mensagem, tipo) {
        // Criar toast
        const toast = document.createElement('div');
        toast.className = `toast-notification toast-${tipo}`;
        toast.innerHTML = `
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-${tipo === 'success' ? 'check-circle' : tipo === 'warning' ? 'exclamation-circle' : 'times-circle'}"></i>
            <span>${mensagem}</span>
          </div>
        `;
        
        // Adicionar ao DOM
        document.body.appendChild(toast);
        
        // Exibir com animação
        setTimeout(() => {
          toast.classList.add('show');
        }, 10);
        
        // Remover após 3 segundos
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => {
            document.body.removeChild(toast);
          }, 300);
        }, 3000);
      }
    });
  </script>
</body>
</html>
